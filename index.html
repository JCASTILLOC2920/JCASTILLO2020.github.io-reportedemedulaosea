<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de M茅dula sea</title>
    <style>
        /* Mobile-first styles */
        body {
            font-family: sans-serif;
            margin: 0;
            display: block; /* Stack elements vertically by default */
        }

        .sidebar {
            width: 100%;
            background-color: #f4f4f4;
            padding: 10px;
            height: auto; /* Auto height for content */
            box-sizing: border-box;
        }

        .sidebar a {
            display: block;
            padding: 10px 15px;
            text-decoration: none;
            color: #333;
            background-color: #ddd;
            margin-bottom: 0; /* Remove margin for a more compact look */
            border-radius: 5px;
            text-align: center;
        }

        .sidebar a:hover {
            background-color: #ccc;
        }

        .main-content {
            padding: 15px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        textarea, button {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            font-size: 16px; /* Larger font for better readability on mobile */
        }
        
        button {
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            margin-top: 5px;
        }
        
        #btnCriterios, #btnCalculo {
             background-color: #6c757d;
             margin-bottom: 5px;
        }


        .modal {
            display: none; 
            position: fixed; 
            z-index: 100; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%; /* More width on small screens */
            max-width: 600px; /* Max width for larger screens */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .close, .close-celularidad {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus,
        .close-celularidad:hover,
        .close-celularidad:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px; /* Slightly smaller for tables on mobile */
        }

        th, td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        /* Desktop styles using media query */
        @media (min-width: 768px) {
            body {
                display: flex; /* Re-enable flexbox for side-by-side layout */
            }

            .sidebar {
                width: 250px; /* A bit wider for desktop */
                height: 100vh;
                padding: 20px;
            }
            
            .sidebar a {
                margin-bottom: 10px; /* Restore margin for desktop view */
            }

            .main-content {
                flex-grow: 1;
                padding: 20px;
            }
            
            .modal-content {
                width: 80%;
                margin: 5% auto;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="informacion_adicional.html">Informaci贸n Adicional</a>
    </div>
    <div class="main-content">
        <div class="container">
            <h1>REPORTE DE MDULA SEA</h1>
            <form id="report-form" onsubmit="return false;">
                <div class="form-group">
                    <label for="antecedentes">ANTECEDENTES:</label>
                    <textarea id="antecedentes" name="antecedentes" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label for="muestra_adecuada">MUESTRA ADECUADA:</label>
                    <button type="button" id="btnCriterios">Criterios de muestra adecuada</button>
                    <textarea id="muestra_adecuada" name="muestra_adecuada" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label for="espacios_intertrabeculares">NMERO DE ESPACIOS INTERTRABECULARES:</label>
                    <textarea id="espacios_intertrabeculares" name="espacios_intertrabeculares" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label for="celularidad">CELULARIDAD:</label>
                    <button type="button" id="btnCalculo">C谩lculo de celularidad</button>
                    <textarea id="celularidad" name="celularidad" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="relacion_mieloeritroide">RELACIN MIELOERITROIDE:</label>
                    <textarea id="relacion_mieloeritroide" name="relacion_mieloeritroide" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label for="megacariocitos">MEGACARIOCITOS:</label>
                    <textarea id="megacariocitos" name="megacariocitos" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="fibrosis">FIBROSIS:</label>
                    <textarea id="fibrosis" name="fibrosis" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label for="granulomas">GRANULOMAS:</label>
                    <textarea id="granulomas" name="granulomas" rows="2"></textarea>
                </div>
                <button type="button" id="btnCrearPrompt">Crear Prompt para DeepSeek</button>
            </form>
        </div>
    </div>

    <!-- The Modals -->
    <div id="myModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Criterios para una Biopsia de M茅dula sea Adecuada</h2>
        <p>En la pr谩ctica, una biopsia se considera adecuada o diagn贸stica cuando cumple con los siguientes criterios:</p>
        <table>
            <thead>
                <tr>
                    <th>Criterio</th>
                    <th>Descripci贸n</th>
                    <th>Importancia</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Longitud</td>
                    <td>Al menos 1.5 - 2 cm (en adultos). Es el par谩metro m谩s objetivo.</td>
                    <td>Longitudes menores (&lt;1 cm) son a menudo no diagn贸sticas, especialmente para evaluar celularidad o infiltrados focales.</td>
                </tr>
                <tr>
                    <td>Integridad Estructural</td>
                    <td>El cilindro debe estar intacto, sin fragmentarse excesivamente, y debe incluir tanto m茅dula 贸sea como hueso cortical y trabecular.</td>
                    <td>Permite evaluar la relaci贸n topogr谩fica normal (ej. megacariocitos paratrabeculares) y la integridad del hueso.</td>
                </tr>
                <tr>
                    <td>Preservaci贸n Arquitect贸nica</td>
                    <td>La arquitectura de la hematopoyesis debe estar bien preservada, sin artefactos por compresi贸n o fijaci贸n.</td>
                    <td>Cr铆tico para diagnosticar trastornos de distribuci贸n (ej. fibrosis, infiltraci贸n linfoide paratrabecular).</td>
                </tr>
                <tr>
                    <td>Representatividad</td>
                    <td>Debe ser representativo del aspirado (si se obtuvo) y del cuadro cl铆nico.</td>
                    <td>Una discrepancia (ej. biopsia hipocelular con aspirado hipercelular) puede indicar un muestreo inadecuado.</td>
                </tr>
            </tbody>
        </table>
        <h3>锔 Signos de una Biopsia Inadecuada</h3>
        <ul>
            <li>Longitud insuficiente (&lt;1 cm en adultos).</li>
            <li>Fragmentaci贸n excesiva que impide evaluar la arquitectura.</li>
            <li>Solo tejido cortical sin m茅dula, o solo m茅dula sin hueso trabecular adyacente.</li>
            <li>Artefactos severos (aplastamiento, fijaci贸n inadecuada) que imposibilitan la interpretaci贸n.</li>
        </ul>
      </div>
    </div>
    
    <div id="celularidadModal" class="modal">
        <div class="modal-content">
            <span class="close-celularidad">&times;</span>
            <h2>C谩lculo de Celularidad y Valores Normales</h2>
            <p><strong> C谩lculo y valores normales seg煤n la edad</strong></p>
            <p>La celularidad se estima por microscop铆a 贸ptica en la biopsia procesada. Su valor "normal" depende principalmente de la edad del paciente. Aqu铆 tienes los puntos de referencia:</p>
            <table>
                <thead>
                    <tr>
                        <th>Grupo de Edad</th>
                        <th>Celularidad Normal Esperada</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Menores de 10 a帽os</td>
                        <td>Aproximadamente 80%</td>
                    </tr>
                    <tr>
                        <td>Adultos j贸venes (~30 a帽os)</td>
                        <td>Alrededor del 50%</td>
                    </tr>
                    <tr>
                        <td>Adultos (rango general)</td>
                        <td>30% - 60% o 50% - 90% en par谩metros citol贸gicos.</td>
                    </tr>
                    <tr>
                        <td>Adultos mayores (70+ a帽os)</td>
                        <td>Puede disminuir a un 30% o menos.</td>
                    </tr>
                </tbody>
            </table>
            <p><strong> Hipocellularidad vs. Hipercelularidad</strong></p>
            <p>Se consideran los siguientes umbrales generales para calificar una m茅dula como anormal en t茅rminos de celularidad:</p>
            <ul>
                <li><strong>M茅dula Hipocelular:</strong> Celularidad menor del 25%. En casos severos, como la anemia apl谩sica grave, la biopsia puede mostrar menos del 25% de c茅lulas normales.</li>
                <li><strong>M茅dula Hipercelular:</strong> Celularidad mayor del 75%.</li>
            </ul>
            <p><strong> Contexto y Causas de las Alteraciones</strong></p>
            <p>La interpretaci贸n siempre depende del contexto cl铆nico. Por ejemplo:</p>
            <ul>
                <li>Una m茅dula <strong>hipercelular</strong> puede deberse a una reacci贸n compensatoria (como en una anemia hemol铆tica) o a una neoplasia (como una leucemia o un s铆ndrome mieloproliferativo). En los s铆ndromes mielodispl谩sicos, la m茅dula suele ser hipercelular a pesar de la citopenia en sangre, debido a hematopoyesis ineficaz.</li>
                <li>Una m茅dula <strong>hipocelular</strong> puede indicar una anemia apl谩sica, da帽o por toxinas, infecciones o simplemente cambios asociados a la edad avanzada.</li>
            </ul>
            <p><strong> Conclusi贸n clave</strong></p>
            <p>La evaluaci贸n de la celularidad medular es un juicio cualitativo fundamentado que integra la estimaci贸n microsc贸pica con puntos de corte establecidos, la edad del paciente y su contexto cl铆nico completo. Una muestra adecuada (con al menos 4 espacios intertrabeculares) es esencial para una valoraci贸n fiable.</p>
        </div>
    </div>
    
    <script>
        // Modal 1: Criterios Muestra
        var modal = document.getElementById("myModal");
        var btn = document.getElementById("btnCriterios");
        var span = document.getElementsByClassName("close")[0];

        btn.onclick = function() {
          modal.style.display = "block";
        }

        span.onclick = function() {
          modal.style.display = "none";
        }

        // Modal 2: Celularidad
        var celularidadModal = document.getElementById("celularidadModal");
        var btnCalculo = document.getElementById("btnCalculo");
        var spanCelularidad = document.getElementsByClassName("close-celularidad")[0];

        btnCalculo.onclick = function() {
          celularidadModal.style.display = "block";
        }

        spanCelularidad.onclick = function() {
          celularidadModal.style.display = "none";
        }
        
        // Prompt Button
        document.getElementById('btnCrearPrompt').onclick = function() {
            const antecedents = document.getElementById('antecedentes').value;
            const muestra = document.getElementById('muestra_adecuada').value;
            const espacios = document.getElementById('espacios_intertrabeculares').value;
            const cellularity = document.getElementById('celularidad').value;
            const relacion = document.getElementById('relacion_mieloeritroide').value;
            const megacariocitos = document.getElementById('megacariocitos').value;
            const fibrosis = document.getElementById('fibrosis').value;
            const granulomas = document.getElementById('granulomas').value;

            const promptText = `Eres un hematopat贸logo senior del MD Anderson Cancer Center. Con los datos proporcionados a continuaci贸n, realiza un reporte anatomopatol贸gico completo, incluyendo un diagn贸stico preliminar, diagn贸sticos diferenciales y sugiere qu茅 estudios complementarios ser铆an necesarios para llegar al diagn贸stico definitivo.

Datos del Paciente/Muestra:
- **ANTECEDENTES:** ${antecedents}
- **MUESTRA ADECUADA:** ${muestra}
- **NMERO DE ESPACIOS INTERTRABECULARES:** ${espacios}
- **CELULARIDAD:** ${cellularity}
- **RELACIN MIELOERITROIDE:** ${relacion}
- **MEGACARIOCITOS:** ${megacariocitos}
- **FIBROSIS:** ${fibrosis}
- **GRANULOMAS:** ${granulomas}`;

            navigator.clipboard.writeText(promptText).then(function() {
                alert('隆Prompt copiado al portapapeles!');
                window.open('https://chat.deepseek.com/', '_blank');
            }, function(err) {
                console.error('Error al copiar el texto: ', err);
                alert('Error al copiar el prompt.');
            });
        };

        // Close modals if clicked outside
        window.onclick = function(event) {
          if (event.target == modal) {
            modal.style.display = "none";
          }
          if (event.target == celularidadModal) {
            celularidadModal.style.display = "none";
          }
        }
    </script>
</body>
</html>